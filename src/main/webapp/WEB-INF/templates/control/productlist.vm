<script src="${urlUtil.assets}/asset/js/jquery-cookie.js"></script>
<style>
p{
	margin: 0;
	padding: 0;
}
.min,.add{
    width: 26px;
    text-align: center;
}
.text_box{
    text-align: center;
    width: 50px;
}
.item-bar span{
	display: inline-block;
	min-width: 60px;
}
</style>
<!-- list -->
<div class="edge-space">
	#foreach($product in $productList)
    <div class="media" data-id="$product.id">
		<img class="media-object pull-left" data-src="holder.js/80x64" alt="64x64" style="width:80px; height:64px;" src="$product.picUrl">
        <div class="media-body" style = "padding-left:10px">
			<h4 class="media-heading">$product.title</h4>
			<p class="text-muted">$product.description </p> 
            <p class="item-bar">
				<span>Â¥$product.getDotPrice()/$product.unit</span>
				<input class="min" name="" type="button" value="-" />
				<input class="text_box" name="" type="text" value="0" />
				<input class="add" name="" type="button" value="+" />
			</p>
		</div>
    </div>
	#end
</div>
<script>
    $(function(){
	   function setCart(id, num){
            var obj = jQuery.objCookie('cart') || {};
            if(num == 0){
                delete obj[id];
            }else{
                obj[id] = num;
            }
            jQuery.objCookie('cart',obj);
        }
       // var textBoxs = $(".text_box");
        $(".add").click(function(e){
            var target = $(e.target),
                p      = target.parent(),
                d      = $(target.parents('.media')[0]),
                id     = d.attr('data-id'),
                textBox = p.find('.text_box');
            textBox.val(parseInt(textBox.val())+1);
            if (parseInt(textBox.val())!=0){
                p.find('.min').attr('disabled',false);
            }
            setCart(id, textBox.val());
            // setTotal();
        });
        $(".min").click(function(e){
            var target = $(e.target),
                p      = target.parent(),
                d      = $(target.parents('.media')[0]),
                id     = d.attr('data-id'),
                textBox = p.find('.text_box');
            textBox.val(parseInt(textBox.val())-1);
            if (parseInt(textBox.val())==0){
                p.find('.min').attr('disabled',true);
            }
            setCart(id, textBox.val());
            // setTotal();
        });
        $('.text_box').blur(function(e){
            var target = $(e.target),
                d      = $(target.parents('.media')[0]),
                id     = d.attr('data-id');
            if(target.val() == ''){
                target.val(1);
            }else if(!$.isNumeric(target.val())){
                var val = parseInt(target.val());
                target.val(val?val:1);
            }
            if(target.val() > 0){
                target.parent().find('.min').attr('disabled',false);
            }else{
                target.parent().find('.min').attr('disabled',true);
            }
            setCart(id, target.val());
        });

       var list = {
            init: function(){
                this.con = $('.edge-space');
                this.bind();
                this.sys();
            },
            bind: function(){
            },
            sys: function(){
                var lists = this.con.children(),
                    obj = jQuery.objCookie('cart');
                for(var i = 0,l = lists.length; i < l && obj; i++){
                    var item = $(lists[i]),
                        textB = item.find('.text_box'),
                        num = obj[item.attr('data-id')];
                    if(num){
                        textB.val(num);
                    }
                }
            }
        };
        list.init();

    });
</script>
