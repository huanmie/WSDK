<script src="${urlUtil.assets}/asset/js/jquery-cookie.js"></script>
<style>
p{
	margin: 0;
	padding: 0;
}
.min,.add{
    width: 26px;
    text-align: center;
}
.text_box{
    text-align: center;
    width: 50px;
}
.item-bar span{
	display: inline-block;
	min-width: 60px;
}
.outer-btn{
	text-align:right;
}
button.buy-btn{
    margin: 10px 0px;
}
</style>

<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
				<h4 class="modal-title" id="myModalLabel"></h4>
			</div>
			<div class="modal-body">
			</div>
		</div>
	</div>
</div>
<!-- list -->
<div class="edge-space">
	#foreach($product in $productList)
    <div class="media" data-id="$product.id" data-toggle="modal" data-target="#myModal">
		<img class="media-object pull-left" data-src="holder.js/80x80" alt="" style="width:80px; height:64px;" src="$product.picUrl">
        <div class="media-body" style="padding-left:10px">
			<h4 class="media-heading">$product.title</h4>
			<div class="modal-title" style="display:none">${product.title}-实景图(敬请期待...)</div>
			<div class="modal-body" style="display:none"><img src="$product.picUrl" /></div>
			<p class="text-muted">$product.description </p>
            <p class="item-bar">
				<span>¥$product.dotPrice/$product.unit</span>
				<span style="float:right">
					<input class="min" name="" type="button" value="-" />
					<input class="text_box" name="" type="text" value="0" />
					<input class="add" name="" type="button" value="+" />
				</span>
			</p>
		</div>
    </div>
	#end
    <div class="outer-btn">
    	<button class="buy-btn">去结算</button>
    </div>
</div>
<script>
    $(function(){
		$('#myModal').on('show.bs.modal', function (e) {
			$(".modal-title" , $(e.target)).html($('.modal-title',$(e.relatedTarget)).html());
			$(".modal-body" , $(e.target)).html($('.modal-body',$(e.relatedTarget)).html());
		})
		$('.buy-btn').click(function(){
			var obj = jQuery.objCookie('cart');
			var flag = false;
			for(var i in obj) {
				flag = true;
				break;
			}
			
			if(flag) {
				window.location.href = "${urlUtil.cart}";
			} else {
				alert("请先选择商品");
			}
		});
		
	   function setCart(id, num){
            var obj = jQuery.objCookie('cart') || {};
            if(num == 0){
                delete obj[id];
            }else{
                obj[id] = num;
            }
            jQuery.objCookie('cart',obj);
        }
        $(".add").click(function(e){
            var target = $(e.target),
                p      = target.parent(),
                d      = $(target.parents('.media')[0]),
                id     = d.attr('data-id'),
                textBox = p.find('.text_box');
            textBox.val(parseInt(textBox.val())+1);
            if (parseInt(textBox.val())!=0){
                p.find('.min').attr('disabled',false);
            }
            setCart(id, textBox.val());
			return false;
        });
        $(".min").click(function(e){
            var target = $(e.target),
                p      = target.parent(),
                d      = $(target.parents('.media')[0]),
                id     = d.attr('data-id'),
                textBox = p.find('.text_box');
            textBox.val(parseInt(textBox.val())-1);
            if (parseInt(textBox.val())==0){
                p.find('.min').attr('disabled',true);
            }
            setCart(id, textBox.val());
			return false;
        });
        $('.text_box').blur(function(e){
            var target = $(e.target),
                d      = $(target.parents('.media')[0]),
                id     = d.attr('data-id');
            if(target.val() == ''){
                target.val(1);
            }else if(!$.isNumeric(target.val())){
                var val = parseInt(target.val());
                target.val(val?val:1);
            }
            if(target.val() > 0){
                target.parent().find('.min').attr('disabled',false);
            }else{
                target.parent().find('.min').attr('disabled',true);
            }
            setCart(id, target.val());
			return false;
        });

       var list = {
            init: function(){
                this.con = $('.edge-space');
                this.bind();
                this.sys();
            },
            bind: function(){
            },
            sys: function(){
                var lists = this.con.children(),
                    obj = jQuery.objCookie('cart');
                for(var i = 0,l = lists.length; i < l && obj; i++){
                    var item = $(lists[i]),
                        textB = item.find('.text_box'),
                        num = obj[item.attr('data-id')];
                    if(num){
                        textB.val(num);
                    } else {
						var min = item.find('.min');
						min.attr('disabled',true);
					}
                }
            }
        };
        list.init();

    });
</script>
